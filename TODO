* NDK crash reporting

* MainActivity.kt: (78, 57): 'setCurrentScreen(Activity, String?, String?): Unit' is deprecated. Deprecated in Java

* migrate from firebase-ml-vision to ML Kit
  X https://developers.google.com/ml-kit/migration
  X ML Kit has removed FaceContour.ALL_POINTS
  X update README
  - close() all handles
  - fix this
    2020-09-06 13:09:53.674 1609-1609/uk.me.jeremygreen.merging.develop E/ImageFragment: face detection failed
        com.google.mlkit.common.MlKitException: Internal error has occurred when executing ML Kit tasks
            at com.google.mlkit.common.sdkinternal.ModelResource.zza(com.google.mlkit:common@@17.0.0:32)
            at com.google.mlkit.common.sdkinternal.zzl.run(Unknown Source:10)
            at com.google.mlkit.common.sdkinternal.zzp.run(com.google.mlkit:common@@17.0.0:3)
            at com.google.mlkit.common.sdkinternal.MlKitThreadPool.zzd(com.google.mlkit:common@@17.0.0:24)
            at com.google.mlkit.common.sdkinternal.MlKitThreadPool.zza(com.google.mlkit:common@@17.0.0:30)
            at com.google.mlkit.common.sdkinternal.zzh.run(Unknown Source:2)
            at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)
            at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)
            at java.lang.Thread.run(Thread.java:764)
         Caused by: java.lang.IllegalStateException: Can't call getPixels() on a recycled bitmap
            at android.graphics.Bitmap.checkRecycled(Bitmap.java:395)
            at android.graphics.Bitmap.getPixels(Bitmap.java:1768)
            at com.google.mlkit.vision.common.internal.ImageConvertUtils.convertToNv21Buffer(com.google.mlkit:vision-common@@16.1.0:28)
            at com.google.mlkit.vision.face.internal.zzb.zza(com.google.android.gms:play-services-mlkit-face-detection@@16.1.1:69)
            at com.google.mlkit.vision.face.internal.zzb.zza(com.google.android.gms:play-services-mlkit-face-detection@@16.1.1:90)
            at com.google.mlkit.vision.face.internal.zzb.run(com.google.android.gms:play-services-mlkit-face-detection@@16.1.1:169)
            at com.google.mlkit.vision.common.internal.MobileVisionBase.zza(com.google.mlkit:vision-common@@16.1.0:23)
            at com.google.mlkit.vision.common.internal.zzc.call(Unknown Source:4)
            at com.google.mlkit.common.sdkinternal.ModelResource.zza(com.google.mlkit:common@@17.0.0:29)
            at com.google.mlkit.common.sdkinternal.zzl.run(Unknown Source:10) 
            at com.google.mlkit.common.sdkinternal.zzp.run(com.google.mlkit:common@@17.0.0:3) 
            at com.google.mlkit.common.sdkinternal.MlKitThreadPool.zzd(com.google.mlkit:common@@17.0.0:24) 
            at com.google.mlkit.common.sdkinternal.MlKitThreadPool.zza(com.google.mlkit:common@@17.0.0:30) 
            at com.google.mlkit.common.sdkinternal.zzh.run(Unknown Source:2) 
            at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167) 
            at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641) 
            at java.lang.Thread.run(Thread.java:764) 

* Splashscreen has very large image on android-21 emulator.

* Only one face drawn even if more are in LiveData event.
  - this is a feature of MLKit
  - detect faces, crop image and redetect single face's contours?
    - probably required anyway, for accurate contour coordinate detection.

* Have seen three faces in LiveData message when there should be two.

* Is FacesView leaking anything?
  - https://proandroiddev.com/5-common-mistakes-when-using-architecture-components-403e9899f4cb

* App link gives "Item not found" error in play store app if android platform is too old.

* Image database has become corrupted:

2019-08-04 20:44:12.917 5264-5264/uk.me.jeremygreen.merging D/ImageFragment: updating image 0 with: file:///data/user/0/uk.me.jeremygreen.merging/files/photos/3b2ed863-133c-4ec5-8a10-c0ebe0e1cbce.jpg
2019-08-04 20:44:12.923 5264-5264/uk.me.jeremygreen.merging D/ImageFragment: updating image 0 with: file:///data/user/0/uk.me.jeremygreen.merging/files/photos/4db3e981-8725-454a-b8af-734f2f3746eb.jpg

2019-08-08 23:41:30.698 9106-9106/? D/FacesView: updating image 2131230833 with: file:///data/user/0/uk.me.jeremygreen.merging/files/photos/2a203507-73b4-498e-b010-c325ecedd673.jpg

* Better play store text etc.
  - short and long description shouldn't be the same.

* Further automate release process.
  - add play store changelog
  - use same changelog for github release notes too.
  - git tag for each release
    - locally before pushing or from CI?

* FirebaseAnalytics.setCurrentScreen gives log warning
  - "W/FA: setCurrentScreen cannot be called with the same class and name"
  - https://stackoverflow.com/a/41786256
  - probably since I happen to have used a class name that same as screen name?

* Google Play store console says, "your app is using an old version of the Google Play developer API".
  - https://android-developers.googleblog.com/2019/03/changes-to-google-play-developer-api.html
  - likely fastlane?
    - https://github.com/fastlane/fastlane/issues/14573

* Can google-services.json(s) be taken from merging-secrets repo?

* Use android app bundle.
  - upload signing key
  - create upload key
  - ???

* Enable crashlytics and analytics in SplashActivity if previously enabled via OnboardingActivity.
  - currently, enable in MainActivity, which avoids need to persist state, but means
    early crashes not visible.

* onboarding accept click area is still not high enough.
  - "This item's height is 38dp. Consider making the height of this touch target 48dp or larger."

* Refactor and refine face-detection implementation.
  - too much code in ImageFragment

* Does splash screen look OK on android 21/22?

* If wipe AVD data, camera app doesn't send photo back to app first time use it.

* ACTION_IMAGE_CAPTURE Intent might not work well on all platforms
  - https://commonsware.com/blog/2015/06/08/action-image-capture-fallacy.html

* Room sends two LiveData events when add faces rows
  - once without coordinates
  - once with
  => have had to remove change detection to the FacesView property observer
  - shouldn't use of transactions prevent this?

* ViewSlider2 position not persisted on rotation.
  - probably since ViewPager2 saves and restores it, but when restored, there are no images in the slider.
  - stop ViewPager2 persisting position itself and persist ViewPager2 id in ViewModel instead
    - observe LiveData<MainActivityState>
    - same problem is moved into code that sets up this LiveData
  - keep hold of restored state and use it for first images update?

* Screenshots in github.

* Repeat face contour detection with cropped images?
  - to improve accuracy of coordinates.

* Don't show splashscreen if start up is fast enough
  - but if do show it, show it for at least 1.5s.

* Unit tests.
  - write some
  - run from test server

* Garbage collect files after delete them and UI has finished updating.
  - when ViewPager2 stops using them
    - https://developer.android.com/reference/android/support/v7/widget/RecyclerView.RecyclerListener.html?
  - on startup, in case app shuts down or crashes before can delete files
    - add database index for file column so can query if it is used
  - don't remove images that camera Intent has created but that aren't yet store in the db.

* Handle rejected permissions.

* Better appName.

* Include licence text in About screen.

* Image-deletion dialogue dismissed if rotate device.
  - use androidx DialogFragment?

* Toggleable overlay showing debug info.

* If possible, stop camera app asking for location permission.

* What happens if Camera app isn't given location permission?

* Test app on Firebase.
  - https://circleci.com/docs/2.0/language-android/#testing-with-firebase-test-lab

* Add more Firebase Analytics events.
  - https://firebase.google.com/docs/analytics/android/start
  - enabled only in release builds.

* Choose colour scheme for app.
  - current scheme gives low-contrast warnings in the pre-launch report.

* Material design
  - implementation 'com.google.android.material:material:1.0.0'
  - don't misuse dark/light primary color resources
  - Floating Action Button should be in fixed position and fade in/out of view as swipe (if remove it from merged image screen)
  - animate the FAB as switch activities.

* GDPR.

* Automated licence report.
  - listed by licence type.
  - jk1?

* Better play-store screenshots.

* CircleCI has too many minor issues
  - no per-branch env. vars.
  - artifacts tab not always shown
    - https://discuss.circleci.com/t/stored-artifacts-not-showing-up-on-a-build/20761/3

* Replace Room with something better?
  - Realm?

* Is it necessary to wait for MLKit model to download when necessary
    - https://firebase.google.com/docs/ml-kit/android/detect-faces#before-you-begin
    - how?
    - is having manifest config. sufficient?
    - https://github.com/firebase/quickstart-android/issues/586
      - for custom image recognition models, not face detection

* Use androidx.palette to ensure image overlay visible?
  - dev/image_overlay_palette

* Persist whether analytics and crashlytics have been opted in to, and enable in MainApplication or OnboardingActivity, not MainActivity.
  - otherwise, might miss some early crashes.

* Configure android lint
  - tune priorities.
  - make CircleCI fail.

* kotlin doesn't use java-style capitalization for CONSTANTS.

* Does idiomatic kotlin use underscores_in_automatic_view_fields?

* Version number screen.

* Why wasn't it possible to get coroutine scope like this?
  - https://developer.android.com/topic/libraries/architecture/coroutines#lifecyclescope
  - had to implement CoroutineScope in ImageFragment instead, which is OK, but not as clear

* Explain need INTERNET permission for model download in play-store app blurb.

* Coherent naming scheme for resource ids.

* Better structure for java packages.

* Move features in this list to github issues.

* Spotbugs.

* "API 'variant.getMergeResources()' is obsolete" gradle sync warning.

* Publish to store.
  - upload signing key
  - change over to building with upload key.
  - https://developer.android.com/distribute/best-practices/launch/launch-checklist

* AndroidManifest says app suports RTL.
  - is that correct?

* Allow app's data to be backed up.
  - set allowBackup="true"
  - android lint says need to exclude "GCM id" since can't be reused

* Make forks build on Circle CI?
  - dummy google-services.json?
